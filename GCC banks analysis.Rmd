---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
theme_set(theme_grey())
```



```{r}
load("/Users/anasf/Desktop/join_panel.Rda")
clean_panel <- join_panel %>% select(c(-24,-25)) %>% drop_na() %>% mutate(ROE = EARN_FOR_COMMON/TOTAL_EQUITY, ROA = EARN_FOR_COMMON/BS_TOT_ASSET, LLR=BS_RSRV_LOAN_LOSS/BS_TOT_LOAN,LLP=IS_PROV_FOR_LOAN_LOSS/BS_TOT_LOAN,NPAR=BS_NON_PERFORM_ASSET/BS_TOT_LOAN,CAR=TOTAL_EQUITY/BS_TOT_ASSET)

```

```{r}
clean_panel %>% ggplot(aes(COUNTRY,BS_RSRV_LOAN_LOSS)) + geom_boxplot()
clean_panel %>% ggplot(aes(IS_ISLAMIC,BS_RSRV_LOAN_LOSS)) + geom_boxplot()
```

Seems like there is a significant difference in the banks reserves for loan losses across the 5 countries and bank type


```{r}
clean_panel %>% ggplot(aes(COUNTRY, BS_NON_PERFORM_ASSET)) + geom_boxplot()
clean_panel %>% ggplot(aes(IS_ISLAMIC, BS_NON_PERFORM_ASSET)) + geom_boxplot()
```

We see a similar pattern to the previous graphs. The non performing loan losses appear to also be significantly different between countries and across types. Recall that the Loan Loss reserves are dependant on the non-performing assets levels. 

```{r}
clean_panel %>% ggplot(aes(IS_ISLAMIC,ROE)) + geom_boxplot()
clean_panel %>% ggplot(aes(COUNTRY,ROE)) + geom_boxplot()
clean_panel %>% ggplot(aes(IS_ISLAMIC,ROA)) + geom_boxplot()
clean_panel %>% ggplot(aes(COUNTRY,ROA)) + geom_boxplot()
```

There seems to be a significant difference in ROE and ROA between banks across countries. On the other hand, there seems to be no difference between islamic or conventional banks ROE/ROA figures

```{r}
clean_panel %>% ggplot(aes(IS_ISLAMIC,LLR)) + geom_boxplot()
clean_panel %>% ggplot(aes(COUNTRY,LLR)) + geom_boxplot()
clean_panel %>% ggplot(aes(IS_ISLAMIC,LLP)) + geom_boxplot()
clean_panel %>% ggplot(aes(COUNTRY,LLP)) + geom_boxplot()
clean_panel %>% ggplot(aes(IS_ISLAMIC,NPAR)) + geom_boxplot()
clean_panel %>% ggplot(aes(COUNTRY,NPAR)) + geom_boxplot()
```

We see differences in loan loss reserve ratios, non performing loan ratios and Loan loss provision rations across countries. We do see a somewhat significant difference in loan loss ratio of Islamic banks and conventional banks. There is no sign of clear difference on the other two metrics between conventional and islamic banks. 

```{r}
clean_panel %>% group_by(COUNTRY, date) %>% summarise(avgllr=mean(LLR)) %>% ggplot(aes(date,avgllr)) + geom_line() + facet_wrap(~COUNTRY)

clean_panel %>% group_by(IS_ISLAMIC, date) %>% summarise(avgllr=mean(LLR)) %>% ggplot(aes(date,avgllr)) + geom_line() + facet_wrap(~IS_ISLAMIC)

clean_panel %>% group_by(COUNTRY, date) %>% summarise(avgllp=mean(LLP)) %>% ggplot(aes(date,avgllp)) + geom_line() + facet_wrap(~COUNTRY)

clean_panel %>% group_by(IS_ISLAMIC, date) %>% summarise(avgllp=mean(LLP)) %>% ggplot(aes(date,avgllp)) + geom_line() + facet_wrap(~IS_ISLAMIC)
```

We see a number of things in the graphs of the average loan loss ratio for banks in the GCC. Banks in Qatar and UAE have somewhat a cyclical pattern in their loan loss ratio particularly post 2014. The UAE saw its loan loss ratio increase by a significant amount from 2010. I suspect it has to do with data reporting. Probably post 2010 is when banks were reporting the loan loss provisions figures more openly maybe due to some regulatory requirement. We can also see that banks in Bahrain and Kuwait perform worse on this measure compared to Saudi, UAE and Qatar based banks. This along with the patterns obeserved before points to clear worse measures for Bahrain and  Kuwait's banking sectors. 

Islamic banks have on average a higher loan loss ratio than conventional banks. The sectors have displayed a significant cyclicality in their quarterly loan loss ratio changes over the years.


```{r}
clean_panel %>% ggplot(aes(LLP,ROE, color=IS_ISLAMIC)) + geom_point() + geom_smooth(method = lm)
clean_panel %>% ggplot(aes(LLP,ROA, color=IS_ISLAMIC)) + geom_point()  + geom_smooth(method = lm)
clean_panel %>% ggplot(aes(LLR,ROE, color=IS_ISLAMIC)) + geom_point()  + geom_smooth(method = lm)
clean_panel %>% ggplot(aes(LLR,ROA, color=IS_ISLAMIC)) + geom_point()  + geom_smooth(method = lm)
clean_panel %>% ggplot(aes(NPAR,ROE, color=IS_ISLAMIC)) + geom_point()  + geom_smooth(method = lm)
clean_panel %>% ggplot(aes(NPAR,ROA, color=IS_ISLAMIC)) + geom_point() + geom_smooth(method = lm)
```

```{r}
clean_panel %>% ggplot(aes(LLP,ROE)) + geom_point() + facet_wrap(~COUNTRY)
clean_panel %>% ggplot(aes(LLP,ROA)) + geom_point() + facet_wrap(~COUNTRY)
clean_panel %>% ggplot(aes(LLR,ROE)) + geom_point() + facet_wrap(~COUNTRY)
clean_panel %>% ggplot(aes(LLR,ROA)) + geom_point() + facet_wrap(~COUNTRY)
clean_panel %>% ggplot(aes(NPAR,ROE)) + geom_point() + facet_wrap(~COUNTRY)
clean_panel %>% ggplot(aes(NPAR,ROA)) + geom_point() + facet_wrap(~COUNTRY)
```

```{r}
clean_panel %>% group_by(date, COUNTRY) %>% summarise(avgcar=mean(CAR)) %>% ggplot(aes(date,avgcar)) + geom_line() + facet_wrap(~COUNTRY)
```


